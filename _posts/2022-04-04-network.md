---
layout: post
title: 네트워크 TCP/IP 개념 정리
subtitle:
header-style: text
author: Juri
tags:
    - network
---

참고: 책 TCP/IP가 보이는 그림책 , 성안당

프로그래밍을 공부하기 위해 대규모의 스터디를 만들었다고 치자. 스터디의 회원이 되는 많은 사람들이 정보를 효과적으로 주고받기 위해서는 운영상의 규칙이 필요할 것이다. 이와 마찬가지로 컴퓨터 네트워크 상에서 주고받기를 원활하게 수행하기 위해 고안한 규칙이 **TCP와 IP**라고 할 수 있다.

## 프로토콜 Protocol

프로토콜을 직역하면 **의정서**, 서로 다른 국가 간에 교환한 합의 문서로 국가끼리 교류하기 위한 정해진 규칙이라고 할 수 있다. 국가를 **컴퓨터**로 바꿔 생각하면 쉽게 이해할 수 있다. 기기끼리 통신할 때 필요한 일련의 절차를 프로토콜이라고 하며 몇 개의 프로토콜에 의해 주고받기가 이루어진다. TCP와IP는 현재 가장 많이 사용하고 있는 프로토콜군이다.

## TCP/IP

### 탄생배경

TCP/IP는 1960년대 미국 국방성이 개발을 지원한 ARPANET이라는 네트워크 상에서 사용할 프로토콜로 개발되었다. ARPANET처럼 여러 개의 LAN을 연결하는 경우에는 통신 방법을 통일할 필요가 있었다.

컴퓨터 간에 데이터를 주고 받을 때, 케이블이나 전파, 적외선을 통해 데이터를 보내려면 모든 데이터를 **전기신호**나 **광신호**로 변환한다. 데이터를 받을 때는 이 신호를 다시 원래의 형태로 변환하는 작업이 필요하다. 이 때 신호를 어떻게 변환했는지를 모르면 원래대로 되돌릴 수가 없다. 따라서, **신호로 변환 -> 전달 -> 데이터 재변환** 이라는 일련의 흐름을 통일시킨 절차를 기본으로 수행되는 **TCP/IP** 구조가 생겨난 것이다.

### 계층화

TCP/IP는 송수신에 필요한 작업을 5개의 단계로 나눠 수행한다. 위로 갈수록 사용자와 가까운 작업을, 아래로 갈수록 기계와 가까운 작업을 담당한다.

| 계층           | 프로토콜                 | 설명                                                                     |
| -------------- | ------------------------ | ------------------------------------------------------------------------ |
| 애플리케이션층 | HTTP, SMTP, POP3, FTP .. | 애플리케이션에 맞춰 통신을 수행할 수 있도록 한다.                        |
| 트랜스포트층   | TCP UDP                  | 송신되는 데이터를 수신측 애플리케이션에 확실하게 전달하기 위해 작동한다. |
| 네트워크층     | IP                       | 수신측 컴퓨터까지 데이터를 전달하기 위해 작동한다.                       |
| 데이터 링크층  | Ethernet, FDDI, ATM ..   | 네트워크에 직접 연결된 기기 간의 전송을 수행한다.                        |
| 물리층         |                          | 데이터를 신호로, 신호를 데이터로 변환한다.                               |

일반적으로 TCP/IP라고 하면 이 5계층 전체를 가리킨다.

### 계층간 연락 방법

송신측의 각 계층에서 수신측의 동일한 계층에서 필요한 정보를 공통된 서식으로 데이터에 추가한다. 데이터보다 앞에 추가한 정보를 **헤더**, 뒤에 추가한 정보를 **트레일러**라고 한다.

상위층에서 추가된 헤더와 트레일러는 캡슐화되어 다른 계층에서 볼 수 없기 때문에 송신측의 각 계층에서 추가된 헤더와 트레일러는 수신측의 동일한 계층에서만 사용할 수 있다.

### 데이터 송수신 단계

(송신)

| 계층           | 작업                                                                             |
| -------------- | -------------------------------------------------------------------------------- |
| 애플리케이션층 | 애플리케이션 간에 데이터를 주고받기 위해 필요한 정보를 써 넣는다.                |
| 트랜스포트층   | 애플리케이션을 나타내는 번호와 데이터를 조합하기 위한 정보를 써 넣는다.          |
| 네트워크층     | 송수신할 컴퓨터의 주소와 수신 불명인 경우 데이터를 파기하는 표시 등을 써 넣는다. |
| 데이터 링크층  | 네트워크의 종류에 맞춘 형식으로 보낼 곳의 정보 등을 써 넣는다.                   |
| 물리층         | 비트열을 신호로 변환한다.                                                        |

(수신)

| 계층           | 작업                                                               |
| -------------- | ------------------------------------------------------------------ |
| 물리층         | 신호를 비트열로 변환한다.                                          |
| 데이터 링크층  | 헤더에 적힌 정보를 확인하고 지정된 프로토콜에 전달한다.            |
| 네트워크층     | 헤더에 적힌 수신처가 맞는지 확인하고 지정된 프로토콜에게 전달한다. |
| 트랜스포트층   | 헤더를 확인하고 데이터를 순서대로 나열해서 조합한다.               |
| 애플리케이션층 | 지정된 애플리케이션에게 전달한다.                                  |

### 패킷통신

TCP/IP에서는 데이터를 일정한 크기로 분할해서 송수신하는 패킷 교환이라는 방법으로 주고받기를 수행한다.

(송신)

1. 데이터를 패킷으로 나눈다.
2. 각 패킷에 수신처나 원래대로 되돌리기 위한 번호 등 필요한 정보를 추가한다.
3. 회선을 사용하여 데이터를 송신한다.

(수신)

1. 자기 앞으로 온 데이터만 받는다.
2. 헤더 정보를 기초로 해서 데이터를 되돌린다.
3. 손상되어 있으면 해당 패킷만 다시 받는다.
4. 데이터를 원래대로 되돌린다.

## 애플리케이션층

TCP/IP 5계층의 맨 위에 위치하는 층으로, 통신 서비스에 대한 서버와 클라이언트의 주고받기를 정하는 프로토콜이 있다. 주요 프로토콜로 `HTTP`, `SMTP`, `POP3`, `TELNET`, `FTP` 등이 있다.

### 애플리케이션 헤더

애플리케이션층에서는 데이터를 트랜스포트층으로 보낼 때 데이터에 서비스를 실현하는 데 필요한 요청과 응답에 관한 정보를 붙여서 보낸다. 이렇게 데이터에 붙여지는 정보를 `헤더`라고 한다. 헤더를 사용하지 않는 프로토콜도 있다.

### HTTP 프로토콜

HTTP 프로토콜은 하나의 요청에 대해 하나의 응답을 반환하는 아주 간단한 프로토콜이다. 실제로 페이지를 구성하고 있는 파일수만큼 이 작업을 반복한다. HTTP 프로토콜에서는 **요청**과 **응답**이라는 두 종류의 패킷을 사용하여 텍스트 형식으로 주고받기를 수행한다.

HTTP 프로토콜은 한 번의 요청과 응답으로 통신은 완결되고 과거에 수행한 통신과 독립된다. 이렇게 한 번으로 끝나는 프로토콜을 무상태(stateless) 라고 한다.

## 트랜스포트층

트랜스포트층은 애플리케이션층과 네트워크층의 중개 역할을 하는 것으로, 받은 데이터를 수신측의 애플리케이션층의 특정 프로토콜에게 전달한다. 이때 목적한 프로토콜을 지정하기 위해서 `포트(port)`라는 장치를 사용한다. 데이터를 보낼 때 데이터가 항상 확실히 전달된다고 할 수 없으므로 문제가 발생한 경우에는 뭔가 방안이 필요하다. 이 때 통신 서비스에 맞는 방법으로 그것을 처리하는 것이 트랜스포트층의 역할이다.

### TCP와 UDP

트랜스포트층에는 **TCP(Transmission Control Protocol)**와 **UDP(User Datagram Protocol)**라는 두 개의 프로토콜이 있다. TCP는 **신뢰성**을, UDP는 **속도**를 중시한다.

(TCP)

-   TCP는 송신하는 데이터를 확실히 상대에게 전달하고 싶을 때 사용한다. TCP를 이용한 서비스로 wwww, 전자메일 등이 있다.
-   수신측과 일대일로 통신한다. **커넥션형 통신**이라고 하며 아래의 3단계로 이루어진다.

    1. 수신측이 데이터를 받을 수 있는 상태인지 확인한 후 통신을 개시한다.
    2. 데이터를 정해진 크기로 분할하고, TCP 헤더를 붙여 송신한다.
    3. 데이터를 다 보내면 통신을 종료한다.

-   수신측은 전해받은 데이터를 원래의 형태로 다시 맞춘 후 애플리케이션층에 전달한다.
-   일정 시간을 기다려도 확인 응답이 없을 때는 이유를 불문하고 세그먼트를 재전송한다.
-   송신 도중 데이터가 파손되면 수신측에서 그 데이터를 파기하고 확인 응답을 보내지 않는다. 이 때 데이터의 파손은 헤더에 있는 체크섬이라는 값을 사용해 판단한다.
-   일정 횟수 이상을 재전송해도 확인 응답이 오지 않는 경우에는 송신측이 강제로 통신을 해제한다.

(UDP)

-   UDP는 송신하는 패킷이 작을 때나 데이터를 재전송할 필요가 없을 때 사용한다. UDP를 이용한 서비스로 IP전화, 스트리밍 등이 있다.
-   UDP에서는 사전 의논을 하지 않고 일방적으로 데이터를 보낸다. **비커넥션형 통신**이라고 한다.
-   수신측이 받을 수 있는지 아닌지 조사하지 않고 데이터를 보내며 수신측은 데이터를 받아도 확인 응답을 보내지 않는다. 송신 도중에 문제가 있어도 재전송 하지 않으며 수신측에서 파손된 데이터는 파기한다.

### 포트번호

애플리케이션층에는 애플리케이션 프로토콜마다 데이터의 출입구인 포트가 있어 통신을 수행할 때 포트 번호를 사용하여 보낼 곳을 지정한다.

| 애플리케이션층 프로토콜 | 포트번호 |
| ----------------------- | -------- |
| HTTP                    | 80       |
| HTTPS                   | 443      |
| SMTP                    | 25       |
| POP3                    | 110      |
| FTP                     | 20, 21   |
| SSH                     | 22       |

포트번호는 0~65535번까지 있으며 0~1023번ㄱ까지는 통신 서비스마다 미리 예약되어 있다.

## 네트워크층

네트워크층은 인터넷층이라고도 하며, 송신측에서는 데이터에 수신처를 특정하는 번호 (IP주소) 등을 기록한 IP 헤더를 붙여 데이터 링크층에 전달하며, 수신측에서는 IP 헤더를 보고 데이터의 손상 유무와 자기 앞으로 온 데이터인지를 확인하여 트랜스포트층의 지정된 프로토콜에게 데이터를 전달한다.

### IP 프로토콜의 역할

-   데이터 링크층에 전달
    트랜스포트층으로부터 받은 데이터에 IP헤더를 붙여 데이터 링크층으로 전달한다. 데이터에 IP 헤더를 붙인 것을 **IP 데이터그램**이라고 한다.

-   Best Effor 방식으로 데이터 전송
    IP 데이터 전송은 **Best Effor** 방식으로 이루어진다. 헤더가 깨지지 않았는지 확인하거나 수신처의 주소가 존재하는지 판단하지만 재전송 처리는 수행하지 않는다.

-   최적의 경로로 보내기
    IP에는 수신처까지의 경로나 통신상태를 보고 가장 빨리 수신처에 전달할 경로를 판단하는 기능이 있다.

-   트랜스포트층에 전달
    수신측에서 IP 헤더에 쓰여진 IP 주소를 확인하고 자기 앞으로 온 것만 받는다. 이후 트랜스포트층의 지정된 프로토콜로 전달한다.

### IP 주소

IP 주소는 네트워크 상의 기기를 구별하기 위한 번호로 32 자리 비트열로 되어있다.

-   네트워크부 : 네트워크 고유의 번호. 같은 네트워크 내에서 동일한 네트워크부를 갖는다.
-   호스트부 : 각각의 컴퓨터를 나타내는 번호. 자유롭게 할당할 수 있다.

IP 주소만으로 네트워크부와 호스트부의 경계를 알 수 없어 **서브넷 마스크**라는 값을 사용해 경계를 나타낸다.

|IP 주소|192.|168.|15.|10|
|서브넷 마스크|255.|255.|0.|0|

```
192.168.15.10 / 16
```

IP 주소 다음에 `/`와 네트워크부의 비트수를 쓴다.

### 라우터

라우터는 네트워크 간을 연결해서 패킷이 수신처에 전달될 때까지 길 안내를 하는 기기다. 라우터의 네트워크층에서는 IP헤더에 기록된 수신처의 IP 주소를 보고 그 다음 전송처를 결정한다.

### ICMP (Internet Control Message Protocol)

IP는 UDP와 같이 비커넥션형 통신을 수행한다. 신뢰성이 떨이지는 IP를 보조하기 위해 ICMP라는 프로토콜이 있다. ICMP는 IP 데이터그램의 통신 상태 등을 필요에 맞게 송신처에게 알려준다.

ICMP 헤더와 ICMP 데이터에 IP 헤더를 붙인 형태로 송신측에 보내진다.

### DNS (Domain Name System)

숫자로 된 IP 주소는 다루기 어려워 문자를 대용할 수 있는 장치인 DNS가 개발되었다. DNS는 애플리케이션 프로토콜이다.
